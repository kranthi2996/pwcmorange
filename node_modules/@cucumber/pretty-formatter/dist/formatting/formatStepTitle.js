"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.formatStepTitle = formatStepTitle;
const TextBuilder_1 = require("../TextBuilder");
function formatStepTitle(testStep, pickleStep, step, status, useStatusIcon, theme, stream) {
    const builder = new TextBuilder_1.TextBuilder(stream);
    if (useStatusIcon) {
        builder.append(theme.status?.icon?.[status] || ' ', theme.status?.all?.[status]).space();
    }
    return builder
        .append(new TextBuilder_1.TextBuilder(stream)
        .append(step.keyword, theme.step?.keyword)
        // step keyword includes a trailing space
        .append(formatStepText(testStep, pickleStep, theme, stream))
        .build(theme.status?.all?.[status]))
        .build();
}
function formatStepText(testStep, pickleStep, theme, stream) {
    const builder = new TextBuilder_1.TextBuilder(stream);
    const stepMatchArgumentsLists = testStep.stepMatchArgumentsLists;
    if (stepMatchArgumentsLists && stepMatchArgumentsLists.length === 1) {
        const stepMatchArguments = stepMatchArgumentsLists[0].stepMatchArguments;
        let currentIndex = 0;
        stepMatchArguments.forEach((argument) => {
            const group = argument.group;
            // Ignore absent values, or groups without a start
            if (group.value !== undefined && group.start !== undefined) {
                const text = pickleStep.text.slice(currentIndex, group.start);
                currentIndex = group.start + group.value.length;
                builder.append(text, theme.step?.text).append(group.value, theme.step?.argument);
            }
        });
        if (currentIndex != pickleStep.text.length) {
            const remainder = pickleStep.text.slice(currentIndex);
            builder.append(remainder, theme.step?.text);
        }
    }
    else {
        builder.append(pickleStep.text, theme.step?.text);
    }
    return builder.build();
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybWF0U3RlcFRpdGxlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2Zvcm1hdHRpbmcvZm9ybWF0U3RlcFRpdGxlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBS0EsMENBc0JDO0FBekJELGdEQUE0QztBQUc1QyxTQUFnQixlQUFlLENBQzdCLFFBQWtCLEVBQ2xCLFVBQXNCLEVBQ3RCLElBQVUsRUFDVixNQUE0QixFQUM1QixhQUFzQixFQUN0QixLQUFZLEVBQ1osTUFBNkI7SUFFN0IsTUFBTSxPQUFPLEdBQUcsSUFBSSx5QkFBVyxDQUFDLE1BQU0sQ0FBQyxDQUFBO0lBQ3ZDLElBQUksYUFBYSxFQUFFLENBQUM7UUFDbEIsT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEdBQUcsRUFBRSxLQUFLLENBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUE7SUFDMUYsQ0FBQztJQUNELE9BQU8sT0FBTztTQUNYLE1BQU0sQ0FDTCxJQUFJLHlCQUFXLENBQUMsTUFBTSxDQUFDO1NBQ3BCLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDO1FBQzFDLHlDQUF5QztTQUN4QyxNQUFNLENBQUMsY0FBYyxDQUFDLFFBQVEsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1NBQzNELEtBQUssQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQ3RDO1NBQ0EsS0FBSyxFQUFFLENBQUE7QUFDWixDQUFDO0FBRUQsU0FBUyxjQUFjLENBQ3JCLFFBQWtCLEVBQ2xCLFVBQXNCLEVBQ3RCLEtBQVksRUFDWixNQUE2QjtJQUU3QixNQUFNLE9BQU8sR0FBRyxJQUFJLHlCQUFXLENBQUMsTUFBTSxDQUFDLENBQUE7SUFDdkMsTUFBTSx1QkFBdUIsR0FBRyxRQUFRLENBQUMsdUJBQXVCLENBQUE7SUFDaEUsSUFBSSx1QkFBdUIsSUFBSSx1QkFBdUIsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFLENBQUM7UUFDcEUsTUFBTSxrQkFBa0IsR0FBRyx1QkFBdUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQTtRQUN4RSxJQUFJLFlBQVksR0FBRyxDQUFDLENBQUE7UUFDcEIsa0JBQWtCLENBQUMsT0FBTyxDQUFDLENBQUMsUUFBUSxFQUFFLEVBQUU7WUFDdEMsTUFBTSxLQUFLLEdBQUcsUUFBUSxDQUFDLEtBQUssQ0FBQTtZQUM1QixrREFBa0Q7WUFDbEQsSUFBSSxLQUFLLENBQUMsS0FBSyxLQUFLLFNBQVMsSUFBSSxLQUFLLENBQUMsS0FBSyxLQUFLLFNBQVMsRUFBRSxDQUFDO2dCQUMzRCxNQUFNLElBQUksR0FBRyxVQUFVLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLEVBQUUsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFBO2dCQUM3RCxZQUFZLEdBQUcsS0FBSyxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQTtnQkFDL0MsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFBO1lBQ2xGLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQTtRQUNGLElBQUksWUFBWSxJQUFJLFVBQVUsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDM0MsTUFBTSxTQUFTLEdBQUcsVUFBVSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUE7WUFDckQsT0FBTyxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsS0FBSyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQTtRQUM3QyxDQUFDO0lBQ0gsQ0FBQztTQUFNLENBQUM7UUFDTixPQUFPLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQTtJQUNuRCxDQUFDO0lBQ0QsT0FBTyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUE7QUFDeEIsQ0FBQyJ9