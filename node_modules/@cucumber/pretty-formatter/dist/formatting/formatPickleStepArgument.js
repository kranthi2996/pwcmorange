"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.formatPickleStepArgument = formatPickleStepArgument;
const TextBuilder_1 = require("../TextBuilder");
function formatPickleStepArgument(pickleStepArgument, theme, stream) {
    if (pickleStepArgument.docString) {
        return formatDocString(pickleStepArgument.docString, theme, stream);
    }
    if (pickleStepArgument.dataTable) {
        return formatDataTable(pickleStepArgument.dataTable, theme, stream);
    }
    throw new Error('PickleStepArgument must have one of dataTable or docString');
}
function formatDocString(docString, theme, stream) {
    const builder = new TextBuilder_1.TextBuilder(stream).append('"""', theme.docString?.delimiter);
    if (docString.mediaType) {
        builder.append(docString.mediaType, theme.docString?.mediaType);
    }
    builder.line();
    // Doc strings are normalized to \n by Gherkin.
    const lines = docString.content.split('\n');
    lines.forEach((line) => {
        builder.append(line, theme.docString?.content).line();
    });
    builder.append('"""', theme.docString?.delimiter);
    return builder.build(theme.docString?.all, true);
}
function formatDataTable(dataTable, theme, stream) {
    const columnWidths = calculateColumnWidths(dataTable);
    const builder = new TextBuilder_1.TextBuilder(stream);
    dataTable.rows.forEach((row, rowIndex) => {
        if (rowIndex > 0) {
            builder.line();
        }
        builder.append('|', theme.dataTable?.border);
        row.cells.forEach((cell, cellIndex) => {
            builder
                .append(' ' + cell.value.padEnd(columnWidths[cellIndex]) + ' ', theme.dataTable?.content)
                .append('|', theme.dataTable?.border);
        });
    });
    return builder.build(theme.dataTable?.all, true);
}
function calculateColumnWidths(dataTable) {
    const columnWidths = [];
    for (const row of dataTable.rows) {
        for (let i = 0; i < row.cells.length; i++) {
            const cellWidth = row.cells[i].value.length;
            if (columnWidths[i] === undefined || cellWidth > columnWidths[i]) {
                columnWidths[i] = cellWidth;
            }
        }
    }
    return columnWidths;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybWF0UGlja2xlU3RlcEFyZ3VtZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2Zvcm1hdHRpbmcvZm9ybWF0UGlja2xlU3RlcEFyZ3VtZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBS0EsNERBWUM7QUFmRCxnREFBNEM7QUFHNUMsU0FBZ0Isd0JBQXdCLENBQ3RDLGtCQUFzQyxFQUN0QyxLQUFZLEVBQ1osTUFBNkI7SUFFN0IsSUFBSSxrQkFBa0IsQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUNqQyxPQUFPLGVBQWUsQ0FBQyxrQkFBa0IsQ0FBQyxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFBO0lBQ3JFLENBQUM7SUFDRCxJQUFJLGtCQUFrQixDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQ2pDLE9BQU8sZUFBZSxDQUFDLGtCQUFrQixDQUFDLFNBQVMsRUFBRSxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUE7SUFDckUsQ0FBQztJQUNELE1BQU0sSUFBSSxLQUFLLENBQUMsNERBQTRELENBQUMsQ0FBQTtBQUMvRSxDQUFDO0FBRUQsU0FBUyxlQUFlLENBQ3RCLFNBQTBCLEVBQzFCLEtBQVksRUFDWixNQUE2QjtJQUU3QixNQUFNLE9BQU8sR0FBRyxJQUFJLHlCQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsU0FBUyxFQUFFLFNBQVMsQ0FBQyxDQUFBO0lBQ2pGLElBQUksU0FBUyxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQ3hCLE9BQU8sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLFNBQVMsRUFBRSxLQUFLLENBQUMsU0FBUyxFQUFFLFNBQVMsQ0FBQyxDQUFBO0lBQ2pFLENBQUM7SUFDRCxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUE7SUFDZCwrQ0FBK0M7SUFDL0MsTUFBTSxLQUFLLEdBQUcsU0FBUyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxD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