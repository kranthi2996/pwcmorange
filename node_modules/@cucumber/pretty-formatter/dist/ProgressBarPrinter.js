"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ProgressBarPrinter = void 0;
const messages_1 = require("@cucumber/messages");
const query_1 = require("@cucumber/query");
const composition_1 = require("./composition");
const formatting_1 = require("./formatting");
const formatProblem_1 = require("./formatting/formatProblem");
const queries_1 = require("./queries");
const theme_1 = require("./theme");
const utils_1 = require("./utils");
var Phase;
(function (Phase) {
    Phase[Phase["PREPARING"] = 0] = "PREPARING";
    Phase[Phase["RUNNING"] = 1] = "RUNNING";
    Phase[Phase["DONE"] = 2] = "DONE";
})(Phase || (Phase = {}));
const DEFAULT_OPTIONS = {
    includeAttachments: true,
    summarise: false,
    theme: theme_1.CUCUMBER_THEME,
};
const MAX_BAR_WIDTH = 50;
const MIN_LEGEND_WIDTH = 30;
/**
 * Prints test progress as an updating progress bar, with problems prepended above
 *
 * @remarks
 * Requires a TTY terminal.
 */
class ProgressBarPrinter {
    stream;
    options;
    query = new query_1.Query();
    printedProblems = [];
    pendingProblems = [];
    phase = Phase.PREPARING;
    finishedScenarios = 0;
    finishedSteps = 0;
    runningScenarios = 0;
    totalScenarios = 0;
    totalSteps = 0;
    /**
     * Creates a new ProgressBarPrinter instance
     *
     * @param params - Initialisation object
     * @param params.stream - The stream being written to, used for feature detection
     * @param params.options - Options for the output
     */
    constructor({ stream = process.stdout, options = {}, } = {}) {
        this.stream = stream;
        this.options = {
            ...DEFAULT_OPTIONS,
            ...options,
        };
        this.rerender(true);
    }
    /**
     * Processes a Cucumber message envelope and prints if appropriate
     *
     * @param message - The Cucumber message envelope to process
     */
    update(message) {
        this.query.update(message);
        if (this.phase === Phase.DONE) {
            return;
        }
        if (message.undefinedParameterType) {
            this.handleUndefinedParameterType(message.undefinedParameterType);
        }
        if (message.testRunStarted) {
            this.handleTestRunStarted();
        }
        if (message.testCase) {
            this.handleTestCase(message.testCase);
        }
        if (message.testRunHookFinished) {
            this.handleTestRunHookFinished(message.testRunHookFinished);
        }
        if (message.testCaseStarted) {
            this.handleTestCaseStarted();
        }
        if (message.testStepFinished) {
            this.handleTestStepFinished();
        }
        if (message.testCaseFinished) {
            this.handleTestCaseFinished(message.testCaseFinished);
        }
        if (message.testRunFinished) {
            this.handleTestRunFinished(message.testRunFinished);
        }
    }
    handleUndefinedParameterType(undefinedParameterType) {
        this.pendingProblems.push({
            type: utils_1.ProblemType.PARAMETER_TYPE,
            details: (0, formatting_1.formatUndefinedParameterType)(undefinedParameterType),
        });
        this.rerender();
    }
    handleTestRunStarted() {
        this.phase = Phase.RUNNING;
        this.rerender();
    }
    handleTestCase(testCase) {
        this.totalScenarios++;
        this.totalSteps += testCase.testSteps.length;
        this.rerender();
    }
    handleTestRunHookFinished(testRunHookFinished) {
        if (!utils_1.NON_REPORTABLE_STATUSES.includes(testRunHookFinished.result.status)) {
            this.pendingProblems.push({
                type: utils_1.ProblemType.GLOBAL_HOOK,
                details: (0, composition_1.composeGlobalHookSummary)(testRunHookFinished, this.query, this.options, this.stream),
            });
            this.rerender();
        }
    }
    handleTestCaseStarted() {
        this.runningScenarios++;
    }
    handleTestStepFinished() {
        this.finishedSteps++;
        this.rerender();
    }
    handleTestCaseFinished(testCaseFinished) {
        this.runningScenarios--;
        this.finishedScenarios++;
        if (testCaseFinished.willBeRetried) {
            const testCase = this.query.findTestCaseBy(testCaseFinished);
            if (testCase) {
                this.finishedScenarios--;
                this.finishedSteps = this.finishedSteps - testCase.testSteps.length;
            }
        }
        else {
            const mostSevereResult = this.query.findMostSevereTestStepResultBy(testCaseFinished);
            if (mostSevereResult && !utils_1.NON_REPORTABLE_STATUSES.includes(mostSevereResult.status)) {
                this.pendingProblems.push({
                    type: utils_1.ProblemType.TEST_CASE,
                    details: (0, composition_1.composeScenarioSummary)(testCaseFinished, this.query, this.options, this.stream),
                });
            }
        }
        this.rerender();
    }
    handleTestRunFinished(testRunFinished) {
        this.phase = Phase.DONE;
        if (testRunFinished.exception) {
            const error = testRunFinished.exception?.stackTrace ||
                testRunFinished.exception?.message ||
                'Unknown error';
            this.pendingProblems.push({
                type: utils_1.ProblemType.TEST_RUN,
                details: '\n' +
                    (0, utils_1.indent)((0, formatting_1.formatError)(error, messages_1.TestStepResultStatus.FAILED, this.options.theme, this.stream), 4),
            });
        }
        this.rerender();
    }
    rerender(initial = false) {
        let output = '';
        if (this.pendingProblems.length > 0) {
            if (this.printedProblems.length === 0) {
                output += 'Problems:\n';
            }
            const problems = this.pendingProblems.splice(0);
            for (const { type, details } of problems) {
                const prefixed = (0, formatProblem_1.formatProblem)(type, details, this.options.theme, this.stream);
                const number = this.printedProblems.length + 1;
                output += `${(0, utils_1.indentNumbered)(prefixed, 2, number)}\n`;
                this.printedProblems.push({ type, details });
            }
        }
        if (this.phase === Phase.DONE && this.options.summarise) {
            output += this.makeSummaryBlock();
        }
        else {
            output += this.makeProgressBlock();
        }
        this.render(output, initial);
    }
    makeSummaryBlock() {
        let output = '\n';
        output += (0, composition_1.composeStats)(this.query, this.options.theme, this.stream);
        output += '\n';
        const suggestions = (0, queries_1.findAllSuggestions)(this.query);
        if (suggestions.length > 0) {
            output += (0, composition_1.composeSnippets)(suggestions);
            output += '\n';
        }
        return output;
    }
    makeProgressBlock() {
        return [
            '',
            this.makeBar(this.finishedScenarios, this.totalScenarios, 'scenarios'),
            this.makeBar(this.finishedSteps, this.totalSteps, 'steps'),
            this.makeStatus(),
            '',
        ].join('\n');
    }
    makeBar(finished, total, label) {
        const barWidth = Math.min(this.stream.columns - MIN_LEGEND_WIDTH, MAX_BAR_WIDTH);
        const ratio = total > 0 ? finished / total : 0;
        const filledCount = Math.round(ratio * barWidth);
        const emptyCount = barWidth - filledCount;
        const filled = '█'.repeat(filledCount);
        const empty = '░'.repeat(emptyCount);
        return `${filled}${empty} ${finished}/${total} ${label}`;
    }
    makeStatus() {
        switch (this.phase) {
            case Phase.PREPARING:
                return 'Getting ready...';
            case Phase.RUNNING:
                return `Running ${this.runningScenarios} scenarios...`;
            case Phase.DONE:
                return 'Done';
        }
    }
    render(content, initial) {
        if (!initial) {
            this.stream.moveCursor(0, -4);
            this.stream.clearScreenDown();
        }
        this.stream.write(content);
    }
}
exports.ProgressBarPrinter = ProgressBarPrinter;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUHJvZ3Jlc3NCYXJQcmludGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL1Byb2dyZXNzQmFyUHJpbnRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFFQSxpREFRMkI7QUFDM0IsMkNBQXVDO0FBRXZDLCtDQUtzQjtBQUN0Qiw2Q0FBd0U7QUFDeEUsOERBQTBEO0FBQzFELHVDQUE4QztBQUM5QyxtQ0FBd0M7QUFFeEMsbUNBQXNGO0FBRXRGLElBQUssS0FJSjtBQUpELFdBQUssS0FBSztJQUNSLDJDQUFTLENBQUE7SUFDVCx1Q0FBTyxDQUFBO0lBQ1AsaUNBQUksQ0FBQTtBQUNOLENBQUMsRUFKSSxLQUFLLEtBQUwsS0FBSyxRQUlUO0FBT0QsTUFBTSxlQUFlLEdBQWlDO0lBQ3BELGtCQUFrQixFQUFFLElBQUk7SUFDeEIsU0FBUyxFQUFFLEtBQUs7SUFDaEIsS0FBSyxFQUFFLHNCQUFjO0NBQ3RCLENBQUE7QUFDRCxNQUFNLGFBQWEsR0FBRyxFQUFFLENBQUE7QUFDeEIsTUFBTSxnQkFBZ0IsR0FBRyxFQUFFLENBQUE7QUFFM0I7Ozs7O0dBS0c7QUFDSCxNQUFhLGtCQUFrQjtJQUNaLE1BQU0sQ0FBYTtJQUNuQixPQUFPLENBQThCO0lBQ3JDLEtBQUssR0FBVSxJQUFJLGFBQUssRUFBRSxDQUFBO0lBQzFCLGVBQWUsR0FBbUIsRUFBRSxDQUFBO0lBQ3BDLGVBQWUsR0FBbUIsRUFBRSxDQUFBO0lBQzdDLEtBQUssR0FBVSxLQUFLLENBQUMsU0FBUyxDQUFBO0lBQzlCLGlCQUFpQixHQUFHLENBQUMsQ0FBQTtJQUNyQixhQUFhLEdBQUcsQ0FBQyxDQUFBO0lBQ2pCLGdCQUFnQixHQUFHLENBQUMsQ0FBQTtJQUNwQixjQUFjLEdBQUcsQ0FBQyxDQUFBO0lBQ2xCLFVBQVUsR0FBRyxDQUFDLENBQUE7SUFFdEI7Ozs7OztPQU1HO0lBQ0gsWUFBWSxFQUNWLE1BQU0sR0FBRyxPQUFPLENBQUMsTUFBTSxFQUN2QixPQUFPLEdBQUcsRUFBRSxNQUlWLEVBQUU7UUFDSixJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQTtRQUNwQixJQUFJLENBQUMsT0FBTyxHQUFHO1lBQ2IsR0FBRyxlQUFlO1lBQ2xCLEdBQUcsT0FBTztTQUNYLENBQUE7UUFDRCxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQ3JCLENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsTUFBTSxDQUFDLE9BQWlCO1FBQ3RCLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFBO1FBRTFCLElBQUksSUFBSSxDQUFDLEtBQUssS0FBSyxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDOUIsT0FBTTtRQUNSLENBQUM7UUFFRCxJQUFJLE9BQU8sQ0FBQyxzQkFBc0IsRUFBRSxDQUFDO1lBQ25DLElBQUksQ0FBQyw0QkFBNEIsQ0FBQyxPQUFPLENBQUMsc0JBQXNCLENBQUMsQ0FBQTtRQUNuRSxDQUFDO1FBRUQsSUFBSSxPQUFPLENBQUMsY0FBYyxFQUFFLENBQUM7WUFDM0IsSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUE7UUFDN0IsQ0FBQztRQUVELElBQUksT0FBTyxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQ3JCLElBQUksQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFBO1FBQ3ZDLENBQUM7UUFFRCxJQUFJLE9BQU8sQ0FBQyxtQkFBbUIsRUFBRSxDQUFDO1lBQ2hDLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxPQUFPLENBQUMsbUJBQW1CLENBQUMsQ0FBQTtRQUM3RCxDQUFDO1FBRUQsSUFBSSxPQUFPLENBQUMsZUFBZSxFQUFFLENBQUM7WUFDNUIsSUFBSSxDQUFDLHFCQUFxQixFQUFFLENBQUE7UUFDOUIsQ0FBQztRQUVELElBQUksT0FBTyxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFDN0IsSUFBSSxDQUFDLHNCQUFzQixFQUFFLENBQUE7UUFDL0IsQ0FBQztRQUVELElBQUksT0FBTyxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFDN0IsSUFBSSxDQUFDLHNCQUFzQixDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFBO1FBQ3ZELENBQUM7UUFFRCxJQUFJLE9BQU8sQ0FBQyxlQUFlLEVBQUUsQ0FBQztZQUM1QixJQUFJLENBQUMscUJBQXFCLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQyxDQUFBO1FBQ3JELENBQUM7SUFDSCxDQUFDO0lBRU8sNEJBQTRCLENBQUMsc0JBQThDO1FBQ2pGLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDO1lBQ3hCLElBQUksRUFBRSxtQkFBVyxDQUFDLGNBQWM7WUFDaEMsT0FBTyxFQUFFLElBQUEseUNBQTRCLEVBQUMsc0JBQXNCLENBQUM7U0FDOUQsQ0FBQyxDQUFBO1FBQ0YsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFBO0lBQ2pCLENBQUM7SUFFTyxvQkFBb0I7UUFDMUIsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFBO1FBQzFCLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQTtJQUNqQixDQUFDO0lBRU8sY0FBYyxDQUFDLFFBQWtCO1FBQ3ZDLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQTtRQUNyQixJQUFJLENBQUMsVUFBVSxJQUFJLFFBQVEsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFBO1FBQzVDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQTtJQUNqQixDQUFDO0lBRU8seUJBQXlCLENBQUMsbUJBQXdDO1FBQ3hFLElBQUksQ0FBQywrQkFBdUIsQ0FBQyxRQUFRLENBQUMsbUJBQW1CLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUM7WUFDekUsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUM7Z0JBQ3hCLElBQUksRUFBRSxtQkFBVyxDQUFDLFdBQVc7Z0JBQzdCLE9BQU8sRUFBRSxJQUFBLHNDQUF3QixFQUMvQixtQkFBbUIsRUFDbkIsSUFBSSxDQUFDLEtBQUssRUFDVixJQUFJLENBQUMsT0FBTyxFQUNaLElBQUksQ0FBQyxNQUFNLENBQ1o7YUFDRixDQUFDLENBQUE7WUFDRixJQUFJLENBQUMsUUFBUSxFQUFFLENBQUE7UUFDakIsQ0FBQztJQUNILENBQUM7SUFFTyxxQkFBcUI7UUFDM0IsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUE7SUFDekIsQ0FBQztJQUVPLHNCQUFzQjtRQUM1QixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUE7UUFDcEIsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFBO0lBQ2pCLENBQUM7SUFFTyxzQkFBc0IsQ0FBQyxnQkFBa0M7UUFDL0QsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUE7UUFDdkIsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUE7UUFFeEIsSUFBSSxnQkFBZ0IsQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUNuQyxNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFBO1lBQzVELElBQUksUUFBUSxFQUFFLENBQUM7Z0JBQ2IsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUE7Z0JBQ3hCLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLGFBQWEsR0FBRyxRQUFRLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQTtZQUNyRSxDQUFDO1FBQ0gsQ0FBQzthQUFNLENBQUM7WUFDTixNQUFNLGdCQUFnQixHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsOEJBQThCLENBQUMsZ0JBQWdCLENBQUMsQ0FBQTtZQUNwRixJQUFJLGdCQUFnQixJQUFJLENBQUMsK0JBQXVCLENBQUMsUUFBUSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUM7Z0JBQ25GLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDO29CQUN4QixJQUFJLEVBQUUsbUJBQVcsQ0FBQyxTQUFTO29CQUMzQixPQUFPLEVBQUUsSUFBQSxvQ0FBc0IsRUFBQyxnQkFBZ0IsRUFBRSxJQUFJLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQztpQkFDekYsQ0FBQyxDQUFBO1lBQ0osQ0FBQztRQUNILENBQUM7UUFDRCxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUE7SUFDakIsQ0FBQztJQUVPLHFCQUFxQixDQUFDLGVBQWdDO1FBQzVELElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQTtRQUN2QixJQUFJLGVBQWUsQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUM5QixNQUFNLEtBQUssR0FDVCxlQUFlLENBQUMsU0FBUyxFQUFFLFVBQVU7Z0JBQ3JDLGVBQWUsQ0FBQyxTQUFTLEVBQUUsT0FBTztnQkFDbEMsZUFBZSxDQUFBO1lBQ2pCLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDO2dCQUN4QixJQUFJLEVBQUUsbUJBQVcsQ0FBQyxRQUFRO2dCQUMxQixPQUFPLEVBQ0wsSUFBSTtvQkFDSixJQUFBLGNBQU0sRUFDSixJQUFBLHdCQUFXLEVBQUMsS0FBSyxFQUFFLCtCQUFvQixDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEVBQ2hGLENBQUMsQ0FDRjthQUNKLENBQUMsQ0FBQTtRQUNKLENBQUM7UUFDRCxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUE7SUFDakIsQ0FBQztJQUVPLFFBQVEsQ0FBQyxPQUFPLEdBQUcsS0FBSztRQUM5QixJQUFJLE1BQU0sR0FBRyxFQUFFLENBQUE7UUFDZixJQUFJLElBQUksQ0FBQyxlQUFlLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQ3BDLElBQUksSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFLENBQUM7Z0JBQ3RDLE1BQU0sSUFBSSxhQUFhLENBQUE7WUFDekIsQ0FBQztZQUNELE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFBO1lBQy9DLEtBQUssTUFBTSxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsSUFBSSxRQUFRLEVBQUUsQ0FBQztnQkFDekMsTUFBTSxRQUFRLEdBQUcsSUFBQSw2QkFBYSxFQUFDLElBQUksRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFBO2dCQUM5RSxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUE7Z0JBQzlDLE1BQU0sSUFBSSxHQUFHLElBQUEsc0JBQWMsRUFBQyxRQUFRLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxJQUFJLENBQUE7Z0JBQ3BELElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUE7WUFDOUMsQ0FBQztRQUNILENBQUM7UUFDRCxJQUFJLElBQUksQ0FBQyxLQUFLLEtBQUssS0FBSyxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBQ3hELE1BQU0sSUFBSSxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQTtRQUNuQyxDQUFDO2FBQU0sQ0FBQztZQUNOLE1BQU0sSUFBSSxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQTtRQUNwQyxDQUFDO1FBQ0QsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUE7SUFDOUIsQ0FBQztJQUVPLGdCQUFnQjtRQUN0QixJQUFJLE1BQU0sR0FBRyxJQUFJLENBQUE7UUFDakIsTUFBTSxJQUFJLElBQUEsMEJBQVksRUFBQyxJQUFJLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQTtRQUNuRSxNQUFNLElBQUksSUFBSSxDQUFBO1FBQ2QsTUFBTSxXQUFXLEdBQUcsSUFBQSw0QkFBa0IsRUFBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDbEQsSUFBSSxXQUFXLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQzNCLE1BQU0sSUFBSSxJQUFBLDZCQUFlLEVBQUMsV0FBVyxDQUFDLENBQUE7WUFDdEMsTUFBTSxJQUFJLElBQUksQ0FBQTtRQUNoQixDQUFDO1FBQ0QsT0FBTyxNQUFNLENBQUE7SUFDZixDQUFDO0lBRU8saUJBQWlCO1FBQ3ZCLE9BQU87WUFDTCxFQUFFO1lBQ0YsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsaUJBQWlCLEVBQUUsSUFBSSxDQUFDLGNBQWMsRUFBRSxXQUFXLENBQUM7WUFDdEUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFLElBQUksQ0FBQyxVQUFVLEVBQUUsT0FBTyxDQUFDO1lBQzFELElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDakIsRUFBRTtTQUNILENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQ2QsQ0FBQztJQUVPLE9BQU8sQ0FBQyxRQUFnQixFQUFFLEtBQWEsRUFBRSxLQUFhO1FBQzVELE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEdBQUcsZ0JBQWdCLEVBQUUsYUFBYSxDQUFDLENBQUE7UUFDaEYsTUFBTSxLQUFLLEdBQUcsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBQzlDLE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxHQUFHLFFBQVEsQ0FBQyxDQUFBO1FBQ2hELE1BQU0sVUFBVSxHQUFHLFFBQVEsR0FBRyxXQUFXLENBQUE7UUFDekMsTUFBTSxNQUFNLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQTtRQUN0QyxNQUFNLEtBQUssR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFBO1FBQ3BDLE9BQU8sR0FBRyxNQUFNLEdBQUcsS0FBSyxJQUFJLFFBQVEsSUFBSSxLQUFLLElBQUksS0FBSyxFQUFFLENBQUE7SUFDMUQsQ0FBQztJQUVPLFVBQVU7UUFDaEIsUUFBUSxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDbkIsS0FBSyxLQUFLLENBQUMsU0FBUztnQkFDbEIsT0FBTyxrQkFBa0IsQ0FBQTtZQUMzQixLQUFLLEtBQUssQ0FBQyxPQUFPO2dCQUNoQixPQUFPLFdBQVcsSUFBSSxDQUFDLGdCQUFnQixlQUFlLENBQUE7WUFDeEQsS0FBSyxLQUFLLENBQUMsSUFBSTtnQkFDYixPQUFPLE1BQU0sQ0FBQTtRQUNqQixDQUFDO0lBQ0gsQ0FBQztJQUVPLE1BQU0sQ0FBQyxPQUFlLEVBQUUsT0FBZ0I7UUFDOUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQ2IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUE7WUFDN0IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxlQUFlLEVBQUUsQ0FBQTtRQUMvQixDQUFDO1FBQ0QsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUE7SUFDNUIsQ0FBQztDQUNGO0FBN09ELGdEQTZPQyJ9