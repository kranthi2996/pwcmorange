"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ProgressPrinter = void 0;
const query_1 = require("@cucumber/query");
const formatting_1 = require("./formatting");
const SummaryPrinter_1 = require("./SummaryPrinter");
const theme_1 = require("./theme");
const DEFAULT_OPTIONS = {
    includeAttachments: true,
    summarise: false,
    theme: theme_1.CUCUMBER_THEME,
};
/**
 * Prints test progress as single-character status indicators
 *
 * @remarks
 * Outputs a character for each test step as they complete, providing a compact
 * real-time view of test progress. Characters are styled according to their status
 * (e.g. `.` for passed, `F` for failed etc).
 */
class ProgressPrinter {
    stream;
    print;
    options;
    query = new query_1.Query();
    /**
     * Creates a new ProgressPrinter instance
     *
     * @param params - Initialisation object
     * @param params.stream - The stream being written to, used for feature detection
     * @param params.options - Options for the output
     */
    constructor({ stream = process.stdout, options = {}, } = {}) {
        this.stream = stream;
        this.print = (content) => stream.write(content);
        this.options = {
            ...DEFAULT_OPTIONS,
            ...options,
        };
    }
    /**
     * Processes a Cucumber message envelope and prints if appropriate
     *
     * @param message - The Cucumber message envelope to process
     */
    update(message) {
        this.query.update(message);
        if (message.testStepFinished) {
            this.print((0, formatting_1.formatStatusCharacter)(message.testStepFinished.testStepResult.status, this.options.theme, this.stream));
        }
        if (message.testRunHookFinished) {
            this.print((0, formatting_1.formatStatusCharacter)(message.testRunHookFinished.result.status, this.options.theme, this.stream));
        }
        if (message.testRunFinished) {
            this.print('\n');
            if (this.options.summarise) {
                this.summarise();
            }
        }
    }
    summarise() {
        SummaryPrinter_1.SummaryPrinter.summarise(this.query, {
            stream: this.stream,
            options: this.options,
        });
    }
}
exports.ProgressPrinter = ProgressPrinter;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUHJvZ3Jlc3NQcmludGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL1Byb2dyZXNzUHJpbnRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFDQSwyQ0FBdUM7QUFFdkMsNkNBQW9EO0FBQ3BELHFEQUFpRDtBQUNqRCxtQ0FBd0M7QUFHeEMsTUFBTSxlQUFlLEdBQThCO0lBQ2pELGtCQUFrQixFQUFFLElBQUk7SUFDeEIsU0FBUyxFQUFFLEtBQUs7SUFDaEIsS0FBSyxFQUFFLHNCQUFjO0NBQ3RCLENBQUE7QUFFRDs7Ozs7OztHQU9HO0FBQ0gsTUFBYSxlQUFlO0lBQ1QsTUFBTSxDQUF1QjtJQUM3QixLQUFLLENBQTJCO0lBQ2hDLE9BQU8sQ0FBMkI7SUFDbEMsS0FBSyxHQUFVLElBQUksYUFBSyxFQUFFLENBQUE7SUFFM0M7Ozs7OztPQU1HO0lBQ0gsWUFBWSxFQUNWLE1BQU0sR0FBRyxPQUFPLENBQUMsTUFBTSxFQUN2QixPQUFPLEdBQUcsRUFBRSxNQUlWLEVBQUU7UUFDSixJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQTtRQUNwQixJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsT0FBTyxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFBO1FBQy9DLElBQUksQ0FBQyxPQUFPLEdBQUc7WUFDYixHQUFHLGVBQWU7WUFDbEIsR0FBRyxPQUFPO1NBQ1gsQ0FBQTtJQUNILENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsTUFBTSxDQUFDLE9BQWlCO1FBQ3RCLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFBO1FBRTFCLElBQUksT0FBTyxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFDN0IsSUFBSSxDQUFDLEtBQUssQ0FDUixJQUFBLGtDQUFxQixFQUNuQixPQUFPLENBQUMsZ0JBQWdCLENBQUMsY0FBYyxDQUFDLE1BQU0sRUFDOUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQ2xCLElBQUksQ0FBQyxNQUFNLENBQ1osQ0FDRixDQUFBO1FBQ0gsQ0FBQztRQUVELElBQUksT0FBTyxDQUFDLG1CQUFtQixFQUFFLENBQUM7WUFDaEMsSUFBSSxDQUFDLEtBQUssQ0FDUixJQUFBLGtDQUFxQixFQUNuQixPQUFPLENBQUMsbUJBQW1CLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFDekMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQ2xCLElBQUksQ0FBQyxNQUFNLENBQ1osQ0FDRixDQUFBO1FBQ0gsQ0FBQztRQUVELElBQUksT0FBTyxDQUFDLGVBQWUsRUFBRSxDQUFDO1lBQzVCLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUE7WUFDaEIsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSxDQUFDO2dCQUMzQixJQUFJLENBQUMsU0FBUyxFQUFFLENBQUE7WUFDbEIsQ0FBQztRQUNILENBQUM7SUFDSCxDQUFDO0lBRU8sU0FBUztRQUNmLCtCQUFjLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDbkMsTUFBTSxFQUFFLElBQUksQ0FBQyxNQUFNO1lBQ25CLE9BQU8sRUFBRSxJQUFJLENBQUMsT0FBTztTQUN0QixDQUFDLENBQUE7SUFDSixDQUFDO0NBQ0Y7QUF0RUQsMENBc0VDIn0=